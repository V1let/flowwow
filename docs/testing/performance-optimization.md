# Отчет по оптимизации производительности

Дата: 20.02.2026  
Проект: Flowwow  
Результат: отчет + внесённые улучшения

## 1. Анализ производительности (кратко)

Наблюдения:
- В ряде сценариев выполняются повторные запросы к `header/footer` на каждой странице.
- В выборках товаров происходила фильтрация архивных записей на уровне приложения.
- При загрузке изображений в продуктах потенциально загружались тяжёлые BLOB‑данные.

## 2. Оптимизация работы с БД

Выполнено:
- Перенос фильтрации архивных товаров в запросы БД:
  - добавлены методы `findNotArchived`, `findActiveHits`, `findActiveNew`.
- Уменьшение нагрузки при загрузке изображений:
  - поле `image_data` переключено на ленивую загрузку (LAZY), чтобы не тащить BLOB при получении списка товаров.

## 3. Оптимизация backend

Выполнено:
- Убрана повторная фильтрация архивных товаров на уровне Java (stream‑фильтрация).
- Сокращён объём данных, загружаемых из БД при работе с изображениями.

## 4. Оптимизация frontend

Выполнено:
- Кэширование `header/footer` в `sessionStorage` по версии — уменьшение количества сетевых запросов на страницах.

## 5. Внесённые изменения (файлы)

- `src/main/java/com/example/flowwow/repository/ProductRepository.java`
- `src/main/java/com/example/flowwow/service/ProductService.java`
- `src/main/java/com/example/flowwow/entity/ProductImage.java`
- `src/main/resources/static/js/common.js`

## 6. Рекомендации (дальнейшие улучшения)

- Добавить индексы в БД на поля `products.slug`, `products.category_id`, `products.is_hit`, `products.is_new`.
- Перейти к постраничной загрузке товаров в каталоге (lazy/pagination).
- Вынести тяжелые выборки в DTO/проекции вместо загрузки целых сущностей.

## 7. Итог

Выполнены реальные улучшения, снижающие нагрузку на БД и уменьшающие количество сетевых запросов.  
Документ подготовлен и может быть дополнен результатами нагрузочного тестирования при необходимости.
