(()=>{function E(e){if(!e||typeof e!="string")return e;let t=e.trim();if(!t||/^(https?:)?\/\//i.test(t)||/^data:/i.test(t)||/^blob:/i.test(t))return t;let a="http://localhost:8080";return t.startsWith("/api/")?`${a}${t}`:t.startsWith("api/")?`${a}/${t}`:t}window.resolveAssetUrl=E;window.toastConfig={default:{maxMessageLength:160,showDelayMs:50,durationMs:2800,removeDelayMs:2800},admin:{maxMessageLength:160,showDelayMs:50,durationMs:2800,removeDelayMs:2800,top:"16px",right:"16px",maxWidth:"320px",padding:"10px 14px",borderRadius:"8px",fontSize:"14px",lineHeight:"1.35"}};function b(e){let t=e?window.toastConfig.admin:window.toastConfig.default,a=window.toastOverrides&&typeof window.toastOverrides=="object"?window.toastOverrides:{};return{...t,...a}}var g="3";window.showToast=function(t,a="success"){let i=window.location.pathname.includes("/other/admin"),s=b(i),n=String(t??"").replace(/\s+/g," ").trim().slice(0,s.maxMessageLength),o=document.createElement("div");o.className=`toast-notification ${a}`,o.textContent=n||"\u0413\u043E\u0442\u043E\u0432\u043E",i&&(o.classList.add("fw-admin-toast"),o.style.position="fixed",o.style.top=s.top,o.style.right=s.right,o.style.bottom="auto",o.style.left="auto",o.style.zIndex="10000",o.style.display="inline-block",o.style.height="auto",o.style.minHeight="0",o.style.maxHeight="none",o.style.maxWidth=s.maxWidth,o.style.width="auto",o.style.padding=s.padding,o.style.borderRadius=s.borderRadius,o.style.boxSizing="border-box",o.style.boxShadow="0 6px 18px rgba(0, 0, 0, 0.2)",o.style.color="#fff",o.style.fontWeight="500",o.style.fontSize=s.fontSize,o.style.lineHeight=s.lineHeight,o.style.whiteSpace="normal",o.style.overflowWrap="anywhere",o.style.wordBreak="break-word",o.style.opacity="0",o.style.transform="translateX(120%)",o.style.transition="opacity 0.25s ease, transform 0.25s ease"),document.body.appendChild(o),setTimeout(()=>{i?(o.style.opacity="1",o.style.transform="translateX(0)"):o.classList.add("show")},s.showDelayMs),setTimeout(()=>{i?(o.style.opacity="0",o.style.transform="translateX(120%)"):o.classList.remove("show"),setTimeout(()=>o.remove(),s.removeDelayMs)},s.durationMs)};document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add("content-loaded");let e=document.getElementById("header-placeholder"),t=document.getElementById("footer-placeholder"),a=window.location.pathname.includes("/other/"),i="../",s=`fw_header_${g}`,n=`fw_footer_${g}`,o=sessionStorage.getItem(s),r=sessionStorage.getItem(n);o&&r&&(e.innerHTML=o,t.innerHTML=r),Promise.all([o?Promise.resolve(o):fetch(`${i}includes/header.html?v=${g}`).then(c=>c.text()),r?Promise.resolve(r):fetch(`${i}includes/footer.html?v=${g}`).then(c=>c.text())]).then(([c,d])=>{o||sessionStorage.setItem(s,c),r||sessionStorage.setItem(n,d),e.innerHTML=c,t.innerHTML=d;let w=document.getElementById("copyright-year");w&&(w.textContent=String(new Date().getFullYear())),x(),window.refreshCartState&&window.refreshCartState();let p=document.getElementById("hamburger"),h=document.getElementById("mobile-menu");p&&h&&p.addEventListener("click",()=>{h.classList.toggle("active")});let u=document.querySelector(".scroll-top");u&&(window.addEventListener("scroll",()=>{u.classList.toggle("visible",window.scrollY>400)}),u.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"})));let y=document.getElementById("auth-btn"),m=document.getElementById("user-sidebar"),v=document.getElementById("close-user-sidebar"),I=document.getElementById("user-logout");y&&m&&y.addEventListener("click",()=>{localStorage.getItem("isLoggedIn")==="true"?m.classList.add("active"):window.location.href="../other/login.html"}),v&&m&&v.addEventListener("click",()=>{m.classList.remove("active")}),I&&I.addEventListener("click",S=>{S.preventDefault(),confirm("\u0412\u044B\u0439\u0442\u0438 \u0438\u0437 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430?")&&(localStorage.removeItem("isLoggedIn"),localStorage.removeItem("jwtToken"),localStorage.removeItem("userName"),localStorage.removeItem("userRole"),window.location.href="../pages/index.html")})}).catch(c=>console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 header/footer:",c))});document.addEventListener("click",async e=>{let t=e.target.closest(".add-to-cart");if(!t)return;let a=t.dataset.id;!a||!window.toggleCartItem||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),await window.toggleCartItem(a,1))},!0);function x(){let e=localStorage.getItem("isLoggedIn")==="true",t=localStorage.getItem("userName")||"\u0413\u043E\u0441\u0442\u044C",a=localStorage.getItem("userRole")||"USER",i=document.getElementById("auth-text"),s=document.getElementById("user-display-name"),n=document.getElementById("user-avatar");i&&(i.textContent=e?t:"\u0412\u043E\u0439\u0442\u0438"),s&&(s.textContent=t);let o=document.getElementById("admin-panel-menu-item"),r=document.getElementById("desktop-admin-link"),c=document.getElementById("mobile-admin-menu-item"),d=e&&a==="ADMIN";o&&(o.style.display=d?"":"none"),r&&(r.style.display=d?"":"none"),c&&(c.style.display=d?"":"none"),n&&(a==="ADMIN"?n.src="https://randomuser.me/api/portraits/men/1.jpg":n.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(t)}&background=e83e8c&color=fff`)}function l(e,t){if(!e)return;let a=e.dataset.originalText||e.textContent.trim()||"\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443";e.dataset.originalText||(e.dataset.originalText=a),t?(e.textContent="\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0435",e.classList.add("in-cart")):(e.textContent=e.dataset.originalText||"\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443",e.classList.remove("in-cart"))}function C(e,t){if(!e)return;let a=String(e);document.querySelectorAll(`.add-to-cart[data-id="${a}"]`).forEach(s=>{l(s,t)});let i=document.getElementById("add-to-cart-btn");i&&String(i.dataset.id)===a&&l(i,t)}function L(e){let t=document.getElementById("cart-count-sidebar");t&&(t.textContent=String(e??0))}window.applyCartState=function(t){if(!t){L(0),document.querySelectorAll(".add-to-cart").forEach(r=>l(r,!1));let o=document.getElementById("add-to-cart-btn");o&&l(o,!1);return}if(typeof t!="object"||(window.__lastCartState=t,t.totalItems!==void 0&&L(t.totalItems||0),!Array.isArray(t.items)))return;let a=t.items,i=new Set(a.map(o=>String(o.productId??""))),s=new Map(a.map(o=>[String(o.productId??""),String(o.id??"")]));window.__cartItemByProductId=s,document.querySelectorAll(".add-to-cart").forEach(o=>{let r=o.dataset.id;r&&l(o,i.has(String(r)))});let n=document.getElementById("add-to-cart-btn");n&&n.dataset.id&&l(n,i.has(String(n.dataset.id)))};window.toggleCartItem=async function(t,a=1){if(!t)return;if(!(typeof window.isLoggedIn=="function"?window.isLoggedIn():localStorage.getItem("isLoggedIn")==="true")){showToast("\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error"),window.location.href="../other/login.html";return}let n=(window.__cartItemByProductId||new Map).get(String(t));try{let o=null;n?(o=await window.api.removeFromCart(n),showToast("\u0422\u043E\u0432\u0430\u0440 \u0443\u0434\u0430\u043B\u0451\u043D \u0438\u0437 \u043A\u043E\u0440\u0437\u0438\u043D\u044B","info"),C(t,!1)):(o=await window.api.addToCart(t,a),showToast("\u0422\u043E\u0432\u0430\u0440 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","success"),C(t,!0)),o&&window.applyCartState&&window.applyCartState(o),window.refreshCartState&&window.refreshCartState()}catch(o){showToast(o.message||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error")}};window.refreshCartState=async function(){if(!(typeof window.isLoggedIn=="function"?window.isLoggedIn():localStorage.getItem("isLoggedIn")==="true")){window.applyCartState(null);return}try{if(window.api&&typeof window.api.getCart=="function"){let i=await window.api.getCart();i&&typeof i=="object"&&window.applyCartState(i);return}let a=await fetch("http://localhost:8080/api/cart",{headers:{Authorization:`Bearer ${localStorage.getItem("jwtToken")}`}});if(a.ok){let i=await a.json();i&&typeof i=="object"&&window.applyCartState(i)}else window.applyCartState(null)}catch(a){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043A\u043E\u0440\u0437\u0438\u043D\u044B:",a),window.applyCartState(null)}};(function(){let t=window.location.hostname;if(!(t==="localhost"||t==="127.0.0.1")||document.querySelector("script[data-livereload]"))return;let i=document.createElement("script");i.src=`http://${t}:35729/livereload.js?snipver=1`,i.async=!0,i.setAttribute("data-livereload","true"),document.body.appendChild(i)})();var f=null;async function $(){try{let e=await api.getHits();A(e.slice(0,3))}catch(e){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043F\u043E\u043F\u0443\u043B\u044F\u0440\u043D\u044B\u0445 \u0442\u043E\u0432\u0430\u0440\u043E\u0432:",e)}}function A(e){let t=document.querySelector(".popular .product-grid");t&&(t.innerHTML=e.map(a=>{let i=a.images?.find(n=>n.isMain)?.imagePath||a.images?.[0]?.imagePath||"../images/placeholder.jpg",s=window.resolveAssetUrl?window.resolveAssetUrl(i):i;return`
        <div class="product-card" data-id="${a.id}">
            <div class="product-img" style="background-image: url('${s}')">
                ${a.oldPrice?'<span class="product-badge">\u0421\u043A\u0438\u0434\u043A\u0430</span>':""}
                <button class="wishlist-btn"><i class="far fa-heart"></i></button>
            </div>
            <div class="product-info">
                <h3>${a.name}</h3>
                <p>${a.description||""}</p>
                <div class="product-rating">
                    ${'<i class="fas fa-star"></i>'.repeat(Math.floor(a.ratingAverage||5))}
                    <span>(${a.reviewsCount||0})</span>
                </div>
                <div class="product-price">
                    <span class="current-price">${a.price.toLocaleString()} \u20BD</span>
                    ${a.oldPrice?`<span class="old-price">${a.oldPrice.toLocaleString()} \u20BD</span>`:""}
                </div>
                <button class="btn btn-small add-to-cart"
                        data-id="${a.id}"
                        data-name="${a.name}"
                        data-price="${a.price}"
                        data-image="${s}">
                    \u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443
                </button>
            </div>
        </div>
    `}).join(""),M(t),window.applyCartState&&window.__lastCartState?window.applyCartState(window.__lastCartState):window.refreshCartState&&window.refreshCartState())}function M(e){e.querySelectorAll(".product-card").forEach(t=>{t.style.cursor="pointer",t.addEventListener("click",a=>{if(a.target.closest(".add-to-cart")||a.target.closest(".wishlist-btn"))return;let i=t.dataset.id;i&&(window.location.href=`product.html?id=${i}`)})}),e.querySelectorAll(".add-to-cart").forEach(t=>{t.addEventListener("click",async a=>{a.preventDefault();let{id:i}=t.dataset;window.toggleCartItem?await window.toggleCartItem(i,1):await B(i,1)})}),e.querySelectorAll(".wishlist-btn i").forEach(async t=>{let i=t.closest(".product-card")?.querySelector(".add-to-cart");if(!i)return;let s=i.dataset.id;if(isLoggedIn())try{await api.isFavorite(s)&&(t.classList.add("fas","active"),t.classList.remove("far"))}catch{}t.addEventListener("click",async()=>{if(!isLoggedIn()){showToast("\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0435","error"),window.location.href="../other/login.html";return}try{await api.isFavorite(s)?(await api.removeFromFavorite(s),t.classList.remove("fas","active"),t.classList.add("far"),showToast("\u0423\u0434\u0430\u043B\u0435\u043D\u043E \u0438\u0437 \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0433\u043E","info")):(await api.addToFavorite(s),t.classList.remove("far"),t.classList.add("fas","active"),showToast("\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E \u0432 \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0435","success"))}catch(n){showToast(n.message,"error")}})})}async function B(e,t=1){if(!isLoggedIn()){showToast("\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error"),window.location.href="../other/login.html";return}try{if(window.toggleCartItem)await window.toggleCartItem(e,t);else{let a=await api.addToCart(e,t);showToast("\u0422\u043E\u0432\u0430\u0440 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","success"),window.applyCartState?window.applyCartState(a):T()}}catch(a){showToast(a.message||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error")}}async function T(){window.refreshCartState&&await window.refreshCartState()}async function P(){try{let e=await api.getCategories();k(e.slice(0,4))}catch(e){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0439:",e)}}function k(e){let t=document.querySelector(".categories .category-grid");!t||e.length===0||(t.innerHTML=e.map(a=>`
        <a href="category.html?id=${a.id}" class="category-card">
            <div class="category-img" style="background-image: url('${window.resolveAssetUrl?window.resolveAssetUrl(a.imagePath||"../images/placeholder.jpg"):a.imagePath||"../images/placeholder.jpg"}')"></div>
            <h3>${a.name}</h3>
        </a>
    `).join(""))}async function _(){try{let e=await api.getRecentReviews(20);D(e),O()}catch(e){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043E\u0442\u0437\u044B\u0432\u043E\u0432:",e)}}function N(e){let t=(e||"").trim();if(!t)return"\u041A";let a=t.split(/\s+/).filter(Boolean);return a.length>=2?`${a[0][0]}${a[1][0]}`.toUpperCase():t.slice(0,2).toUpperCase()}function D(e){let t=document.querySelector(".testimonials .testimonial-slider");if(t){if(!Array.isArray(e)||e.length===0){t.innerHTML='<p class="loading">\u041F\u043E\u043A\u0430 \u043D\u0435\u0442 \u043E\u0442\u0437\u044B\u0432\u043E\u0432</p>';return}t.innerHTML=e.map((a,i)=>`
        <div class="testimonial-slide ${i===0?"active":""}">
            <div class="testimonial-content">
                <div class="rating">
                    ${'<i class="fas fa-star"></i>'.repeat(a.rating||5)}
                    ${'<i class="far fa-star"></i>'.repeat(Math.max(0,5-(a.rating||5)))}
                </div>
                <p class="testimonial-text">"${a.text||"\u0411\u0435\u0437 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F"}"</p>
                <div class="client-info">
                    <div class="client-photo">${N(a.authorName||"\u041A\u043B\u0438\u0435\u043D\u0442")}</div>
                    <div class="client-details">
                        <h4>${a.authorName||"\u041A\u043B\u0438\u0435\u043D\u0442"}</h4>
                        <p>${a.product?.name||"\u0417\u0430\u043A\u0430\u0437"}</p>
                    </div>
                </div>
            </div>
        </div>
    `).join("")}}function O(){let e=document.querySelectorAll(".testimonial-slide");if(e.length<=1)return;f&&clearInterval(f);let t=0;f=setInterval(()=>{e[t].classList.remove("active"),t=(t+1)%e.length,e[t].classList.add("active")},6e3)}document.addEventListener("DOMContentLoaded",()=>{$(),P(),_(),T(),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();let a=this.getAttribute("href");if(a==="#")return;let i=document.querySelector(a);i&&i.scrollIntoView({behavior:"smooth"})})})});})();
