(()=>{function q(e){if(!e||typeof e!="string")return e;let t=e.trim();if(!t||/^(https?:)?\/\//i.test(t)||/^data:/i.test(t)||/^blob:/i.test(t))return t;let o="http://localhost:8080";return t.startsWith("/api/")?`${o}${t}`:t.startsWith("api/")?`${o}/${t}`:t}window.resolveAssetUrl=q;window.toastConfig={default:{maxMessageLength:160,showDelayMs:50,durationMs:2800,removeDelayMs:2800},admin:{maxMessageLength:160,showDelayMs:50,durationMs:2800,removeDelayMs:2800,top:"16px",right:"16px",maxWidth:"320px",padding:"10px 14px",borderRadius:"8px",fontSize:"14px",lineHeight:"1.35"}};function L(e){let t=e?window.toastConfig.admin:window.toastConfig.default,o=window.toastOverrides&&typeof window.toastOverrides=="object"?window.toastOverrides:{};return{...t,...o}}var g="3";window.showToast=function(t,o="success"){let s=window.location.pathname.includes("/other/admin"),n=L(s),i=String(t??"").replace(/\s+/g," ").trim().slice(0,n.maxMessageLength),r=document.createElement("div");r.className=`toast-notification ${o}`,r.textContent=i||"\u0413\u043E\u0442\u043E\u0432\u043E",s&&(r.classList.add("fw-admin-toast"),r.style.position="fixed",r.style.top=n.top,r.style.right=n.right,r.style.bottom="auto",r.style.left="auto",r.style.zIndex="10000",r.style.display="inline-block",r.style.height="auto",r.style.minHeight="0",r.style.maxHeight="none",r.style.maxWidth=n.maxWidth,r.style.width="auto",r.style.padding=n.padding,r.style.borderRadius=n.borderRadius,r.style.boxSizing="border-box",r.style.boxShadow="0 6px 18px rgba(0, 0, 0, 0.2)",r.style.color="#fff",r.style.fontWeight="500",r.style.fontSize=n.fontSize,r.style.lineHeight=n.lineHeight,r.style.whiteSpace="normal",r.style.overflowWrap="anywhere",r.style.wordBreak="break-word",r.style.opacity="0",r.style.transform="translateX(120%)",r.style.transition="opacity 0.25s ease, transform 0.25s ease"),document.body.appendChild(r),setTimeout(()=>{s?(r.style.opacity="1",r.style.transform="translateX(0)"):r.classList.add("show")},n.showDelayMs),setTimeout(()=>{s?(r.style.opacity="0",r.style.transform="translateX(120%)"):r.classList.remove("show"),setTimeout(()=>r.remove(),n.removeDelayMs)},n.durationMs)};document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add("content-loaded");let e=document.getElementById("header-placeholder"),t=document.getElementById("footer-placeholder"),o=window.location.pathname.includes("/other/"),s="../",n=`fw_header_${g}`,i=`fw_footer_${g}`,r=sessionStorage.getItem(n),a=sessionStorage.getItem(i);r&&a&&(e.innerHTML=r,t.innerHTML=a),Promise.all([r?Promise.resolve(r):fetch(`${s}includes/header.html?v=${g}`).then(d=>d.text()),a?Promise.resolve(a):fetch(`${s}includes/footer.html?v=${g}`).then(d=>d.text())]).then(([d,u])=>{r||sessionStorage.setItem(n,d),a||sessionStorage.setItem(i,u),e.innerHTML=d,t.innerHTML=u;let w=document.getElementById("copyright-year");w&&(w.textContent=String(new Date().getFullYear())),$(),window.refreshCartState&&window.refreshCartState();let y=document.getElementById("hamburger"),f=document.getElementById("mobile-menu");y&&f&&y.addEventListener("click",()=>{f.classList.toggle("active")});let h=document.querySelector(".scroll-top");h&&(window.addEventListener("scroll",()=>{h.classList.toggle("visible",window.scrollY>400)}),h.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"})));let p=document.getElementById("auth-btn"),m=document.getElementById("user-sidebar"),S=document.getElementById("close-user-sidebar"),I=document.getElementById("user-logout");p&&m&&p.addEventListener("click",()=>{localStorage.getItem("isLoggedIn")==="true"?m.classList.add("active"):window.location.href="../other/login.html"}),S&&m&&S.addEventListener("click",()=>{m.classList.remove("active")}),I&&I.addEventListener("click",v=>{v.preventDefault(),confirm("\u0412\u044B\u0439\u0442\u0438 \u0438\u0437 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430?")&&(localStorage.removeItem("isLoggedIn"),localStorage.removeItem("jwtToken"),localStorage.removeItem("userName"),localStorage.removeItem("userRole"),window.location.href="../pages/index.html")})}).catch(d=>console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 header/footer:",d))});document.addEventListener("click",async e=>{let t=e.target.closest(".add-to-cart");if(!t)return;let o=t.dataset.id;!o||!window.toggleCartItem||(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),await window.toggleCartItem(o,1))},!0);function $(){let e=localStorage.getItem("isLoggedIn")==="true",t=localStorage.getItem("userName")||"\u0413\u043E\u0441\u0442\u044C",o=localStorage.getItem("userRole")||"USER",s=document.getElementById("auth-text"),n=document.getElementById("user-display-name"),i=document.getElementById("user-avatar");s&&(s.textContent=e?t:"\u0412\u043E\u0439\u0442\u0438"),n&&(n.textContent=t);let r=document.getElementById("admin-panel-menu-item"),a=document.getElementById("desktop-admin-link"),d=document.getElementById("mobile-admin-menu-item"),u=e&&o==="ADMIN";r&&(r.style.display=u?"":"none"),a&&(a.style.display=u?"":"none"),d&&(d.style.display=u?"":"none"),i&&(o==="ADMIN"?i.src="https://randomuser.me/api/portraits/men/1.jpg":i.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(t)}&background=e83e8c&color=fff`)}function l(e,t){if(!e)return;let o=e.dataset.originalText||e.textContent.trim()||"\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443";e.dataset.originalText||(e.dataset.originalText=o),t?(e.textContent="\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0435",e.classList.add("in-cart")):(e.textContent=e.dataset.originalText||"\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443",e.classList.remove("in-cart"))}function E(e,t){if(!e)return;let o=String(e);document.querySelectorAll(`.add-to-cart[data-id="${o}"]`).forEach(n=>{l(n,t)});let s=document.getElementById("add-to-cart-btn");s&&String(s.dataset.id)===o&&l(s,t)}function T(e){let t=document.getElementById("cart-count-sidebar");t&&(t.textContent=String(e??0))}window.applyCartState=function(t){if(!t){T(0),document.querySelectorAll(".add-to-cart").forEach(a=>l(a,!1));let r=document.getElementById("add-to-cart-btn");r&&l(r,!1);return}if(typeof t!="object"||(window.__lastCartState=t,t.totalItems!==void 0&&T(t.totalItems||0),!Array.isArray(t.items)))return;let o=t.items,s=new Set(o.map(r=>String(r.productId??""))),n=new Map(o.map(r=>[String(r.productId??""),String(r.id??"")]));window.__cartItemByProductId=n,document.querySelectorAll(".add-to-cart").forEach(r=>{let a=r.dataset.id;a&&l(r,s.has(String(a)))});let i=document.getElementById("add-to-cart-btn");i&&i.dataset.id&&l(i,s.has(String(i.dataset.id)))};window.toggleCartItem=async function(t,o=1){if(!t)return;if(!(typeof window.isLoggedIn=="function"?window.isLoggedIn():localStorage.getItem("isLoggedIn")==="true")){showToast("\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error"),window.location.href="../other/login.html";return}let i=(window.__cartItemByProductId||new Map).get(String(t));try{let r=null;i?(r=await window.api.removeFromCart(i),showToast("\u0422\u043E\u0432\u0430\u0440 \u0443\u0434\u0430\u043B\u0451\u043D \u0438\u0437 \u043A\u043E\u0440\u0437\u0438\u043D\u044B","info"),E(t,!1)):(r=await window.api.addToCart(t,o),showToast("\u0422\u043E\u0432\u0430\u0440 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","success"),E(t,!0)),r&&window.applyCartState&&window.applyCartState(r),window.refreshCartState&&window.refreshCartState()}catch(r){showToast(r.message||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error")}};window.refreshCartState=async function(){if(!(typeof window.isLoggedIn=="function"?window.isLoggedIn():localStorage.getItem("isLoggedIn")==="true")){window.applyCartState(null);return}try{if(window.api&&typeof window.api.getCart=="function"){let s=await window.api.getCart();s&&typeof s=="object"&&window.applyCartState(s);return}let o=await fetch("http://localhost:8080/api/cart",{headers:{Authorization:`Bearer ${localStorage.getItem("jwtToken")}`}});if(o.ok){let s=await o.json();s&&typeof s=="object"&&window.applyCartState(s)}else window.applyCartState(null)}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043A\u043E\u0440\u0437\u0438\u043D\u044B:",o),window.applyCartState(null)}};(function(){let t=window.location.hostname;if(!(t==="localhost"||t==="127.0.0.1")||document.querySelector("script[data-livereload]"))return;let s=document.createElement("script");s.src=`http://${t}:35729/livereload.js?snipver=1`,s.async=!0,s.setAttribute("data-livereload","true"),document.body.appendChild(s)})();var C="http://localhost:8080/api",B={get token(){return localStorage.getItem("jwtToken")},set token(e){e?localStorage.setItem("jwtToken",e):localStorage.removeItem("jwtToken")},headers(){let e={"Content-Type":"application/json"};return this.token&&(e.Authorization=`Bearer ${this.token}`),e},async request(e,t={}){let o=await fetch(C+e,{...t,headers:{...this.headers(),...t.headers}});if(o.status===401)throw this.token=null,localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userRole"),window.location.href="../other/login.html",new Error("Unauthorized");if(o.status===403)throw new Error("\u0414\u043E\u0441\u0442\u0443\u043F \u0437\u0430\u043F\u0440\u0435\u0449\u0451\u043D");if(!o.ok){let n=await o.text().catch(()=>"Unknown error");throw new Error(n||o.statusText)}if(o.status===204)return null;let s=await o.text();if(!s)return null;try{return JSON.parse(s)}catch{return s}},login(e){return this.request("/auth/login",{method:"POST",body:JSON.stringify(e)})},register(e){return this.request("/auth/register",{method:"POST",body:JSON.stringify(e)})},forgotPassword(e){return this.request("/auth/forgot-password",{method:"POST",body:JSON.stringify({email:e})})},resetPassword(e,t){return this.request("/auth/reset-password",{method:"POST",body:JSON.stringify({token:e,newPassword:t})})},getProducts(e={}){let t=new URLSearchParams(e).toString();return this.request(`/products?${t}`)},getProductBySlug(e){return this.request(`/products/${e}`)},getProductById(e){return this.request(`/products/id/${e}`)},getHits(){return this.request("/products/hits")},getNew(){return this.request("/products/new")},getCategories(){return this.request("/categories")},getCategoryBySlug(e){return this.request(`/categories/${e}`)},getCategoryById(e){return this.request(`/categories/id/${e}`)},getCart(){return this.request("/cart")},addToCart(e,t=1){return this.request("/cart/items",{method:"POST",body:JSON.stringify({productId:e,quantity:t})})},updateCartItem(e,t){return this.request(`/cart/items/${e}?quantity=${t}`,{method:"PUT"})},removeFromCart(e){return this.request(`/cart/items/${e}`,{method:"DELETE"})},clearCart(){return this.request("/cart",{method:"DELETE"})},getFavorites(){return this.request("/favorites")},addToFavorite(e){return this.request(`/favorites/${e}`,{method:"POST"})},removeFromFavorite(e){return this.request(`/favorites/${e}`,{method:"DELETE"})},isFavorite(e){return this.request(`/favorites/check/${e}`)},getMyOrders(){return this.request("/orders/my")},getOrderById(e){return this.request(`/orders/${e}`)},createOrder(e){return this.request("/orders",{method:"POST",body:JSON.stringify(e)})},getProductReviews(e){return this.request(`/reviews/product/${e}`)},getRecentReviews(e=3){return this.request(`/reviews/recent?limit=${e}`)},createReview(e,t,o){let s=localStorage.getItem("userName")||"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C";return this.request("/reviews",{method:"POST",body:JSON.stringify({productId:e,authorName:s,rating:t,text:o})})},getTestimonials(){return this.request("/content/testimonials")},getTeamMembers(){return this.request("/content/team")},getBlogPosts(e=0,t=10){return this.request(`/content/blog?page=${e}&size=${t}`)},getBlogPostBySlug(e){return this.request(`/content/blog/${e}`)},getDashboard(){return this.request("/admin/dashboard")},getAdminProducts(){return this.request("/admin/products")},getArchivedAdminProducts(){return this.request("/admin/products/archive")},createProduct(e){return this.request("/admin/products",{method:"POST",body:JSON.stringify(e)})},updateProduct(e,t){return this.request(`/admin/products/${e}`,{method:"PUT",body:JSON.stringify(t)})},updateProductPartial(e,t){return this.request(`/admin/products/${e}`,{method:"PATCH",body:JSON.stringify(t)})},uploadProductImage(e,t,o=!1){let s=new FormData;return s.append("file",t),s.append("isMain",o?"true":"false"),fetch(`${C}/products/${e}/images/upload`,{method:"POST",headers:this.token?{Authorization:`Bearer ${this.token}`}:{},body:s}).then(async n=>{if(!n.ok){let i=await n.text().catch(()=>"Upload error");throw new Error(i||n.statusText)}return n.json()})},deleteProduct(e){return this.request(`/admin/products/${e}`,{method:"DELETE"})},restoreProduct(e){return this.request(`/admin/products/${e}/restore`,{method:"POST"})},getAdminOrders(e=0,t=10){return this.request(`/admin/orders?page=${e}&size=${t}`)},getAdminOrderById(e){return this.request(`/admin/orders/${e}`)},updateOrderStatus(e,t){return this.request(`/admin/orders/${e}/status?status=${t}`,{method:"PUT"})},getAdminCategories(){return this.request("/admin/categories")},createCategory(e){return this.request("/admin/categories",{method:"POST",body:JSON.stringify(e)})},updateCategory(e,t){return this.request(`/admin/categories/${e}`,{method:"PUT",body:JSON.stringify(t)})},deleteCategory(e){return this.request(`/admin/categories/${e}`,{method:"DELETE"})},getAdminUsers(e=0,t=10){return this.request(`/admin/users?page=${e}&size=${t}`)},updateUserStatus(e,t){return this.request(`/admin/users/${e}/status?isActive=${t}`,{method:"PUT"})},deleteUser(e){return this.request(`/admin/users/${e}`,{method:"DELETE"})},getPendingReviews(e=0,t=10){return this.request(`/reviews/pending?page=${e}&size=${t}`)},approveReview(e){return this.request(`/reviews/${e}/approve`,{method:"POST"})},rejectReview(e){return this.request(`/reviews/${e}/reject`,{method:"POST"})}};window.api=B;window.isLoggedIn=function(){return localStorage.getItem("isLoggedIn")==="true"};window.isAdmin=function(){return localStorage.getItem("userRole")==="ADMIN"&&window.isLoggedIn()};window.getJwtToken=function(){return localStorage.getItem("jwtToken")};var c=null;document.addEventListener("DOMContentLoaded",async()=>{if(!isLoggedIn()){showToast("\u0412\u043E\u0439\u0434\u0438\u0442\u0435 \u0434\u043B\u044F \u043E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u044F \u0437\u0430\u043A\u0430\u0437\u0430","error"),window.location.href="../other/login.html";return}try{c=await api.getCart(),b()}catch(t){showToast("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error"),document.getElementById("order-items").innerHTML=`<p class="error">\u041E\u0448\u0438\u0431\u043A\u0430: ${t.message}</p>`;return}if(!c.items||c.items.length===0){showToast("\u0412\u0430\u0448\u0430 \u043A\u043E\u0440\u0437\u0438\u043D\u0430 \u043F\u0443\u0441\u0442\u0430","error"),window.location.href="../pages/catalog.html";return}let e=new Date().toISOString().split("T")[0];document.getElementById("delivery-date").min=e,document.getElementById("delivery-date").value=e,await P(),document.getElementById("order-form").addEventListener("submit",x)});async function P(){try{let e=localStorage.getItem("userName")||"";e&&(document.getElementById("customer-name").value=e)}catch(e){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445:",e)}}function b(){let e=document.getElementById("order-items"),t=document.getElementById("order-total");if(!c.items||c.items.length===0){e.innerHTML="<p>\u041A\u043E\u0440\u0437\u0438\u043D\u0430 \u043F\u0443\u0441\u0442\u0430</p>",t.textContent="0 \u20BD";return}e.innerHTML=c.items.map(s=>{let n=s.productImage||"../images/placeholder.jpg",i=window.resolveAssetUrl?window.resolveAssetUrl(n):n,r=s.productName||"\u0422\u043E\u0432\u0430\u0440",a=s.price||0,d=s.quantity||1,u=a*d;return`
            <div class="order-item">
                <div class="order-item-img" style="background-image: url('${i}')"></div>
                <div class="order-item-info">
                    <h4>${r}</h4>
                    <p>${d} \u0448\u0442. \xD7 ${a.toLocaleString()} \u20BD = ${u.toLocaleString()} \u20BD</p>
                </div>
            </div>
        `}).join("");let o=c.totalPrice||c.items.reduce((s,n)=>s+n.price*n.quantity,0);t.textContent=`${o.toLocaleString()} \u20BD`}async function x(e){if(e.preventDefault(),!c||!c.items||c.items.length===0){showToast("\u041A\u043E\u0440\u0437\u0438\u043D\u0430 \u043F\u0443\u0441\u0442\u0430","error");return}let t={customerName:document.getElementById("customer-name").value.trim(),customerPhone:document.getElementById("customer-phone").value.trim(),customerEmail:document.getElementById("customer-email").value.trim(),deliveryAddress:document.getElementById("delivery-address").value.trim(),deliveryDate:document.getElementById("delivery-date").value,deliveryTime:document.getElementById("delivery-time").value,comment:document.getElementById("comment").value.trim(),items:c.items.map(o=>({productId:o.productId,quantity:o.quantity||1}))};if(!t.customerName||!t.customerPhone||!t.customerEmail||!t.deliveryAddress||!t.deliveryDate){showToast("\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0432\u0441\u0435 \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u043F\u043E\u043B\u044F","error");return}try{let o=await api.createOrder(t);showToast("\u0417\u0430\u043A\u0430\u0437 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0444\u043E\u0440\u043C\u043B\u0435\u043D!","success");try{await api.clearCart()}catch(s){console.warn("\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u043A\u043E\u0440\u0437\u0438\u043D\u0443:",s)}setTimeout(()=>{window.location.href=`order-success.html?id=${o.id}`},1e3)}catch(o){showToast(o.message||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0444\u043E\u0440\u043C\u0438\u0442\u044C \u0437\u0430\u043A\u0430\u0437","error")}}})();
