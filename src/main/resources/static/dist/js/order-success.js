(()=>{function L(o){if(!o||typeof o!="string")return o;let e=o.trim();if(!e||/^(https?:)?\/\//i.test(e)||/^data:/i.test(e)||/^blob:/i.test(e))return e;let a="http://localhost:8080";return e.startsWith("/api/")?`${a}${e}`:e.startsWith("api/")?`${a}/${e}`:e}window.resolveAssetUrl=L;window.toastConfig={default:{maxMessageLength:160,showDelayMs:50,durationMs:2800,removeDelayMs:2800},admin:{maxMessageLength:160,showDelayMs:50,durationMs:2800,removeDelayMs:2800,top:"16px",right:"16px",maxWidth:"320px",padding:"10px 14px",borderRadius:"8px",fontSize:"14px",lineHeight:"1.35"}};function x(o){let e=o?window.toastConfig.admin:window.toastConfig.default,a=window.toastOverrides&&typeof window.toastOverrides=="object"?window.toastOverrides:{};return{...e,...a}}var u="3";window.showToast=function(e,a="success"){let n=window.location.pathname.includes("/other/admin"),s=x(n),i=String(e??"").replace(/\s+/g," ").trim().slice(0,s.maxMessageLength),t=document.createElement("div");t.className=`toast-notification ${a}`,t.textContent=i||"\u0413\u043E\u0442\u043E\u0432\u043E",n&&(t.classList.add("fw-admin-toast"),t.style.position="fixed",t.style.top=s.top,t.style.right=s.right,t.style.bottom="auto",t.style.left="auto",t.style.zIndex="10000",t.style.display="inline-block",t.style.height="auto",t.style.minHeight="0",t.style.maxHeight="none",t.style.maxWidth=s.maxWidth,t.style.width="auto",t.style.padding=s.padding,t.style.borderRadius=s.borderRadius,t.style.boxSizing="border-box",t.style.boxShadow="0 6px 18px rgba(0, 0, 0, 0.2)",t.style.color="#fff",t.style.fontWeight="500",t.style.fontSize=s.fontSize,t.style.lineHeight=s.lineHeight,t.style.whiteSpace="normal",t.style.overflowWrap="anywhere",t.style.wordBreak="break-word",t.style.opacity="0",t.style.transform="translateX(120%)",t.style.transition="opacity 0.25s ease, transform 0.25s ease"),document.body.appendChild(t),setTimeout(()=>{n?(t.style.opacity="1",t.style.transform="translateX(0)"):t.classList.add("show")},s.showDelayMs),setTimeout(()=>{n?(t.style.opacity="0",t.style.transform="translateX(120%)"):t.classList.remove("show"),setTimeout(()=>t.remove(),s.removeDelayMs)},s.durationMs)};document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add("content-loaded");let o=document.getElementById("header-placeholder"),e=document.getElementById("footer-placeholder"),a=window.location.pathname.includes("/other/"),n="../",s=`fw_header_${u}`,i=`fw_footer_${u}`,t=sessionStorage.getItem(s),r=sessionStorage.getItem(i);t&&r&&(o.innerHTML=t,e.innerHTML=r),Promise.all([t?Promise.resolve(t):fetch(`${n}includes/header.html?v=${u}`).then(d=>d.text()),r?Promise.resolve(r):fetch(`${n}includes/footer.html?v=${u}`).then(d=>d.text())]).then(([d,l])=>{t||sessionStorage.setItem(s,d),r||sessionStorage.setItem(i,l),o.innerHTML=d,e.innerHTML=l;let f=document.getElementById("copyright-year");f&&(f.textContent=String(new Date().getFullYear())),E(),window.refreshCartState&&window.refreshCartState();let w=document.getElementById("hamburger"),h=document.getElementById("mobile-menu");w&&h&&w.addEventListener("click",()=>{h.classList.toggle("active")});let g=document.querySelector(".scroll-top");g&&(window.addEventListener("scroll",()=>{g.classList.toggle("visible",window.scrollY>400)}),g.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"})));let y=document.getElementById("auth-btn"),m=document.getElementById("user-sidebar"),p=document.getElementById("close-user-sidebar"),I=document.getElementById("user-logout");y&&m&&y.addEventListener("click",()=>{localStorage.getItem("isLoggedIn")==="true"?m.classList.add("active"):window.location.href="../other/login.html"}),p&&m&&p.addEventListener("click",()=>{m.classList.remove("active")}),I&&I.addEventListener("click",S=>{S.preventDefault(),confirm("\u0412\u044B\u0439\u0442\u0438 \u0438\u0437 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430?")&&(localStorage.removeItem("isLoggedIn"),localStorage.removeItem("jwtToken"),localStorage.removeItem("userName"),localStorage.removeItem("userRole"),window.location.href="../pages/index.html")})}).catch(d=>console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 header/footer:",d))});document.addEventListener("click",async o=>{let e=o.target.closest(".add-to-cart");if(!e)return;let a=e.dataset.id;!a||!window.toggleCartItem||(o.preventDefault(),o.stopPropagation(),o.stopImmediatePropagation(),await window.toggleCartItem(a,1))},!0);function E(){let o=localStorage.getItem("isLoggedIn")==="true",e=localStorage.getItem("userName")||"\u0413\u043E\u0441\u0442\u044C",a=localStorage.getItem("userRole")||"USER",n=document.getElementById("auth-text"),s=document.getElementById("user-display-name"),i=document.getElementById("user-avatar");n&&(n.textContent=o?e:"\u0412\u043E\u0439\u0442\u0438"),s&&(s.textContent=e);let t=document.getElementById("admin-panel-menu-item"),r=document.getElementById("desktop-admin-link"),d=document.getElementById("mobile-admin-menu-item"),l=o&&a==="ADMIN";t&&(t.style.display=l?"":"none"),r&&(r.style.display=l?"":"none"),d&&(d.style.display=l?"":"none"),i&&(a==="ADMIN"?i.src="https://randomuser.me/api/portraits/men/1.jpg":i.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(e)}&background=e83e8c&color=fff`)}function c(o,e){if(!o)return;let a=o.dataset.originalText||o.textContent.trim()||"\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443";o.dataset.originalText||(o.dataset.originalText=a),e?(o.textContent="\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0435",o.classList.add("in-cart")):(o.textContent=o.dataset.originalText||"\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443",o.classList.remove("in-cart"))}function C(o,e){if(!o)return;let a=String(o);document.querySelectorAll(`.add-to-cart[data-id="${a}"]`).forEach(s=>{c(s,e)});let n=document.getElementById("add-to-cart-btn");n&&String(n.dataset.id)===a&&c(n,e)}function v(o){let e=document.getElementById("cart-count-sidebar");e&&(e.textContent=String(o??0))}window.applyCartState=function(e){if(!e){v(0),document.querySelectorAll(".add-to-cart").forEach(r=>c(r,!1));let t=document.getElementById("add-to-cart-btn");t&&c(t,!1);return}if(typeof e!="object"||(window.__lastCartState=e,e.totalItems!==void 0&&v(e.totalItems||0),!Array.isArray(e.items)))return;let a=e.items,n=new Set(a.map(t=>String(t.productId??""))),s=new Map(a.map(t=>[String(t.productId??""),String(t.id??"")]));window.__cartItemByProductId=s,document.querySelectorAll(".add-to-cart").forEach(t=>{let r=t.dataset.id;r&&c(t,n.has(String(r)))});let i=document.getElementById("add-to-cart-btn");i&&i.dataset.id&&c(i,n.has(String(i.dataset.id)))};window.toggleCartItem=async function(e,a=1){if(!e)return;if(!(typeof window.isLoggedIn=="function"?window.isLoggedIn():localStorage.getItem("isLoggedIn")==="true")){showToast("\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error"),window.location.href="../other/login.html";return}let i=(window.__cartItemByProductId||new Map).get(String(e));try{let t=null;i?(t=await window.api.removeFromCart(i),showToast("\u0422\u043E\u0432\u0430\u0440 \u0443\u0434\u0430\u043B\u0451\u043D \u0438\u0437 \u043A\u043E\u0440\u0437\u0438\u043D\u044B","info"),C(e,!1)):(t=await window.api.addToCart(e,a),showToast("\u0422\u043E\u0432\u0430\u0440 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","success"),C(e,!0)),t&&window.applyCartState&&window.applyCartState(t),window.refreshCartState&&window.refreshCartState()}catch(t){showToast(t.message||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error")}};window.refreshCartState=async function(){if(!(typeof window.isLoggedIn=="function"?window.isLoggedIn():localStorage.getItem("isLoggedIn")==="true")){window.applyCartState(null);return}try{if(window.api&&typeof window.api.getCart=="function"){let n=await window.api.getCart();n&&typeof n=="object"&&window.applyCartState(n);return}let a=await fetch("http://localhost:8080/api/cart",{headers:{Authorization:`Bearer ${localStorage.getItem("jwtToken")}`}});if(a.ok){let n=await a.json();n&&typeof n=="object"&&window.applyCartState(n)}else window.applyCartState(null)}catch(a){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043A\u043E\u0440\u0437\u0438\u043D\u044B:",a),window.applyCartState(null)}};(function(){let e=window.location.hostname;if(!(e==="localhost"||e==="127.0.0.1")||document.querySelector("script[data-livereload]"))return;let n=document.createElement("script");n.src=`http://${e}:35729/livereload.js?snipver=1`,n.async=!0,n.setAttribute("data-livereload","true"),document.body.appendChild(n)})();})();
