(()=>{function b(o){if(!o||typeof o!="string")return o;let t=o.trim();if(!t||/^(https?:)?\/\//i.test(t)||/^data:/i.test(t)||/^blob:/i.test(t))return t;let e="http://localhost:8080";return t.startsWith("/api/")?`${e}${t}`:t.startsWith("api/")?`${e}/${t}`:t}window.resolveAssetUrl=b;window.toastConfig={default:{maxMessageLength:160,showDelayMs:50,durationMs:2800,removeDelayMs:2800},admin:{maxMessageLength:160,showDelayMs:50,durationMs:2800,removeDelayMs:2800,top:"16px",right:"16px",maxWidth:"320px",padding:"10px 14px",borderRadius:"8px",fontSize:"14px",lineHeight:"1.35"}};function x(o){let t=o?window.toastConfig.admin:window.toastConfig.default,e=window.toastOverrides&&typeof window.toastOverrides=="object"?window.toastOverrides:{};return{...t,...e}}var w="3";window.showToast=function(t,e="success"){let n=window.location.pathname.includes("/other/admin"),s=x(n),i=String(t??"").replace(/\s+/g," ").trim().slice(0,s.maxMessageLength),a=document.createElement("div");a.className=`toast-notification ${e}`,a.textContent=i||"\u0413\u043E\u0442\u043E\u0432\u043E",n&&(a.classList.add("fw-admin-toast"),a.style.position="fixed",a.style.top=s.top,a.style.right=s.right,a.style.bottom="auto",a.style.left="auto",a.style.zIndex="10000",a.style.display="inline-block",a.style.height="auto",a.style.minHeight="0",a.style.maxHeight="none",a.style.maxWidth=s.maxWidth,a.style.width="auto",a.style.padding=s.padding,a.style.borderRadius=s.borderRadius,a.style.boxSizing="border-box",a.style.boxShadow="0 6px 18px rgba(0, 0, 0, 0.2)",a.style.color="#fff",a.style.fontWeight="500",a.style.fontSize=s.fontSize,a.style.lineHeight=s.lineHeight,a.style.whiteSpace="normal",a.style.overflowWrap="anywhere",a.style.wordBreak="break-word",a.style.opacity="0",a.style.transform="translateX(120%)",a.style.transition="opacity 0.25s ease, transform 0.25s ease"),document.body.appendChild(a),setTimeout(()=>{n?(a.style.opacity="1",a.style.transform="translateX(0)"):a.classList.add("show")},s.showDelayMs),setTimeout(()=>{n?(a.style.opacity="0",a.style.transform="translateX(120%)"):a.classList.remove("show"),setTimeout(()=>a.remove(),s.removeDelayMs)},s.durationMs)};document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add("content-loaded");let o=document.getElementById("header-placeholder"),t=document.getElementById("footer-placeholder"),e=window.location.pathname.includes("/other/"),n="../",s=`fw_header_${w}`,i=`fw_footer_${w}`,a=sessionStorage.getItem(s),r=sessionStorage.getItem(i);a&&r&&(o.innerHTML=a,t.innerHTML=r),Promise.all([a?Promise.resolve(a):fetch(`${n}includes/header.html?v=${w}`).then(d=>d.text()),r?Promise.resolve(r):fetch(`${n}includes/footer.html?v=${w}`).then(d=>d.text())]).then(([d,l])=>{a||sessionStorage.setItem(s,d),r||sessionStorage.setItem(i,l),o.innerHTML=d,t.innerHTML=l;let m=document.getElementById("copyright-year");m&&(m.textContent=String(new Date().getFullYear())),B(),window.refreshCartState&&window.refreshCartState();let u=document.getElementById("hamburger"),c=document.getElementById("mobile-menu");u&&c&&u.addEventListener("click",()=>{c.classList.toggle("active")});let h=document.querySelector(".scroll-top");h&&(window.addEventListener("scroll",()=>{h.classList.toggle("visible",window.scrollY>400)}),h.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"})));let v=document.getElementById("auth-btn"),f=document.getElementById("user-sidebar"),I=document.getElementById("close-user-sidebar"),S=document.getElementById("user-logout");v&&f&&v.addEventListener("click",()=>{localStorage.getItem("isLoggedIn")==="true"?f.classList.add("active"):window.location.href="../other/login.html"}),I&&f&&I.addEventListener("click",()=>{f.classList.remove("active")}),S&&S.addEventListener("click",L=>{L.preventDefault(),confirm("\u0412\u044B\u0439\u0442\u0438 \u0438\u0437 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430?")&&(localStorage.removeItem("isLoggedIn"),localStorage.removeItem("jwtToken"),localStorage.removeItem("userName"),localStorage.removeItem("userRole"),window.location.href="../pages/index.html")})}).catch(d=>console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 header/footer:",d))});document.addEventListener("click",async o=>{let t=o.target.closest(".add-to-cart");if(!t)return;let e=t.dataset.id;!e||!window.toggleCartItem||(o.preventDefault(),o.stopPropagation(),o.stopImmediatePropagation(),await window.toggleCartItem(e,1))},!0);function B(){let o=localStorage.getItem("isLoggedIn")==="true",t=localStorage.getItem("userName")||"\u0413\u043E\u0441\u0442\u044C",e=localStorage.getItem("userRole")||"USER",n=document.getElementById("auth-text"),s=document.getElementById("user-display-name"),i=document.getElementById("user-avatar");n&&(n.textContent=o?t:"\u0412\u043E\u0439\u0442\u0438"),s&&(s.textContent=t);let a=document.getElementById("admin-panel-menu-item"),r=document.getElementById("desktop-admin-link"),d=document.getElementById("mobile-admin-menu-item"),l=o&&e==="ADMIN";a&&(a.style.display=l?"":"none"),r&&(r.style.display=l?"":"none"),d&&(d.style.display=l?"":"none"),i&&(e==="ADMIN"?i.src="https://randomuser.me/api/portraits/men/1.jpg":i.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(t)}&background=e83e8c&color=fff`)}function g(o,t){if(!o)return;let e=o.dataset.originalText||o.textContent.trim()||"\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443";o.dataset.originalText||(o.dataset.originalText=e),t?(o.textContent="\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0435",o.classList.add("in-cart")):(o.textContent=o.dataset.originalText||"\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443",o.classList.remove("in-cart"))}function C(o,t){if(!o)return;let e=String(o);document.querySelectorAll(`.add-to-cart[data-id="${e}"]`).forEach(s=>{g(s,t)});let n=document.getElementById("add-to-cart-btn");n&&String(n.dataset.id)===e&&g(n,t)}function E(o){let t=document.getElementById("cart-count-sidebar");t&&(t.textContent=String(o??0))}window.applyCartState=function(t){if(!t){E(0),document.querySelectorAll(".add-to-cart").forEach(r=>g(r,!1));let a=document.getElementById("add-to-cart-btn");a&&g(a,!1);return}if(typeof t!="object"||(window.__lastCartState=t,t.totalItems!==void 0&&E(t.totalItems||0),!Array.isArray(t.items)))return;let e=t.items,n=new Set(e.map(a=>String(a.productId??""))),s=new Map(e.map(a=>[String(a.productId??""),String(a.id??"")]));window.__cartItemByProductId=s,document.querySelectorAll(".add-to-cart").forEach(a=>{let r=a.dataset.id;r&&g(a,n.has(String(r)))});let i=document.getElementById("add-to-cart-btn");i&&i.dataset.id&&g(i,n.has(String(i.dataset.id)))};window.toggleCartItem=async function(t,e=1){if(!t)return;if(!(typeof window.isLoggedIn=="function"?window.isLoggedIn():localStorage.getItem("isLoggedIn")==="true")){showToast("\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error"),window.location.href="../other/login.html";return}let i=(window.__cartItemByProductId||new Map).get(String(t));try{let a=null;i?(a=await window.api.removeFromCart(i),showToast("\u0422\u043E\u0432\u0430\u0440 \u0443\u0434\u0430\u043B\u0451\u043D \u0438\u0437 \u043A\u043E\u0440\u0437\u0438\u043D\u044B","info"),C(t,!1)):(a=await window.api.addToCart(t,e),showToast("\u0422\u043E\u0432\u0430\u0440 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","success"),C(t,!0)),a&&window.applyCartState&&window.applyCartState(a),window.refreshCartState&&window.refreshCartState()}catch(a){showToast(a.message||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error")}};window.refreshCartState=async function(){if(!(typeof window.isLoggedIn=="function"?window.isLoggedIn():localStorage.getItem("isLoggedIn")==="true")){window.applyCartState(null);return}try{if(window.api&&typeof window.api.getCart=="function"){let n=await window.api.getCart();n&&typeof n=="object"&&window.applyCartState(n);return}let e=await fetch("http://localhost:8080/api/cart",{headers:{Authorization:`Bearer ${localStorage.getItem("jwtToken")}`}});if(e.ok){let n=await e.json();n&&typeof n=="object"&&window.applyCartState(n)}else window.applyCartState(null)}catch(e){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043A\u043E\u0440\u0437\u0438\u043D\u044B:",e),window.applyCartState(null)}};(function(){let t=window.location.hostname;if(!(t==="localhost"||t==="127.0.0.1")||document.querySelector("script[data-livereload]"))return;let n=document.createElement("script");n.src=`http://${t}:35729/livereload.js?snipver=1`,n.async=!0,n.setAttribute("data-livereload","true"),document.body.appendChild(n)})();var p="http://localhost:8080/api";document.addEventListener("DOMContentLoaded",()=>{let o=document.querySelectorAll(".auth-tab"),t=document.getElementById("login-form"),e=document.getElementById("register-form");if(o.forEach(n=>{n.addEventListener("click",()=>{let s=n.dataset.tab;o.forEach(i=>i.classList.remove("active")),n.classList.add("active"),s==="login"?(t.classList.remove("hidden"),e.classList.add("hidden")):(t.classList.add("hidden"),e.classList.remove("hidden")),document.querySelectorAll(".error").forEach(i=>{i.classList.add("hidden"),i.textContent=""})})}),t){let n=document.getElementById("login-error-msg");t.addEventListener("submit",async s=>{s.preventDefault(),n&&(n.classList.add("hidden"),n.textContent="");let i=document.getElementById("login-email").value.trim(),a=document.getElementById("login-password").value.trim();try{let r=await fetch(`${p}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,password:a})});if(!r.ok){let l=await r.text().catch(()=>"\u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u0445\u043E\u0434\u0430");throw new Error(l||"\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 email \u0438\u043B\u0438 \u043F\u0430\u0440\u043E\u043B\u044C")}let d=await r.json();localStorage.setItem("jwtToken",d.token),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userName",d.name||d.email||i),localStorage.setItem("userRole",d.role||"USER"),d.role==="ADMIN"?window.location.href="../other/admin.html":window.location.href="../pages/index.html"}catch(r){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0430\u0432\u0442\u043E\u0440\u0438\u0437\u0430\u0446\u0438\u0438:",r),n&&(n.textContent=r.message||"\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 email \u0438\u043B\u0438 \u043F\u0430\u0440\u043E\u043B\u044C",n.classList.remove("hidden"))}})}if(e){let n=document.getElementById("register-error-msg");e.addEventListener("submit",async s=>{s.preventDefault(),n&&(n.classList.add("hidden"),n.textContent="");let i=document.getElementById("register-name").value.trim(),a=document.getElementById("register-email").value.trim(),r=document.getElementById("register-phone").value.trim(),d=document.getElementById("register-password").value.trim(),l=document.getElementById("register-confirm").value.trim();if(d!==l){n&&(n.textContent="\u041F\u0430\u0440\u043E\u043B\u0438 \u043D\u0435 \u0441\u043E\u0432\u043F\u0430\u0434\u0430\u044E\u0442",n.classList.remove("hidden"));return}try{let m=await fetch(`${p}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,email:a,phone:r,password:d})});if(!m.ok){let c=await m.text().catch(()=>"\u041E\u0448\u0438\u0431\u043A\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438");throw new Error(c||"\u041E\u0448\u0438\u0431\u043A\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438")}let u=await fetch(`${p}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:d})});if(u.ok){let c=await u.json();localStorage.setItem("jwtToken",c.token),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userName",c.name||c.email||a),localStorage.setItem("userRole",c.role||"USER"),window.location.href="../pages/index.html"}}catch(m){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438:",m),n&&(n.textContent=m.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",n.classList.remove("hidden"))}})}});var y=null;async function A(){try{let o=await api.getHits();M(o.slice(0,3))}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043F\u043E\u043F\u0443\u043B\u044F\u0440\u043D\u044B\u0445 \u0442\u043E\u0432\u0430\u0440\u043E\u0432:",o)}}function M(o){let t=document.querySelector(".popular .product-grid");t&&(t.innerHTML=o.map(e=>{let n=e.images?.find(i=>i.isMain)?.imagePath||e.images?.[0]?.imagePath||"../images/placeholder.jpg",s=window.resolveAssetUrl?window.resolveAssetUrl(n):n;return`
        <div class="product-card" data-id="${e.id}">
            <div class="product-img" style="background-image: url('${s}')">
                ${e.oldPrice?'<span class="product-badge">\u0421\u043A\u0438\u0434\u043A\u0430</span>':""}
                <button class="wishlist-btn"><i class="far fa-heart"></i></button>
            </div>
            <div class="product-info">
                <h3>${e.name}</h3>
                <p>${e.description||""}</p>
                <div class="product-rating">
                    ${'<i class="fas fa-star"></i>'.repeat(Math.floor(e.ratingAverage||5))}
                    <span>(${e.reviewsCount||0})</span>
                </div>
                <div class="product-price">
                    <span class="current-price">${e.price.toLocaleString()} \u20BD</span>
                    ${e.oldPrice?`<span class="old-price">${e.oldPrice.toLocaleString()} \u20BD</span>`:""}
                </div>
                <button class="btn btn-small add-to-cart"
                        data-id="${e.id}"
                        data-name="${e.name}"
                        data-price="${e.price}"
                        data-image="${s}">
                    \u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443
                </button>
            </div>
        </div>
    `}).join(""),$(t),window.applyCartState&&window.__lastCartState?window.applyCartState(window.__lastCartState):window.refreshCartState&&window.refreshCartState())}function $(o){o.querySelectorAll(".product-card").forEach(t=>{t.style.cursor="pointer",t.addEventListener("click",e=>{if(e.target.closest(".add-to-cart")||e.target.closest(".wishlist-btn"))return;let n=t.dataset.id;n&&(window.location.href=`product.html?id=${n}`)})}),o.querySelectorAll(".add-to-cart").forEach(t=>{t.addEventListener("click",async e=>{e.preventDefault();let{id:n}=t.dataset;window.toggleCartItem?await window.toggleCartItem(n,1):await k(n,1)})}),o.querySelectorAll(".wishlist-btn i").forEach(async t=>{let n=t.closest(".product-card")?.querySelector(".add-to-cart");if(!n)return;let s=n.dataset.id;if(isLoggedIn())try{await api.isFavorite(s)&&(t.classList.add("fas","active"),t.classList.remove("far"))}catch{}t.addEventListener("click",async()=>{if(!isLoggedIn()){showToast("\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0435","error"),window.location.href="../other/login.html";return}try{await api.isFavorite(s)?(await api.removeFromFavorite(s),t.classList.remove("fas","active"),t.classList.add("far"),showToast("\u0423\u0434\u0430\u043B\u0435\u043D\u043E \u0438\u0437 \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0433\u043E","info")):(await api.addToFavorite(s),t.classList.remove("far"),t.classList.add("fas","active"),showToast("\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u043E \u0432 \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0435","success"))}catch(i){showToast(i.message,"error")}})})}async function k(o,t=1){if(!isLoggedIn()){showToast("\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error"),window.location.href="../other/login.html";return}try{if(window.toggleCartItem)await window.toggleCartItem(o,t);else{let e=await api.addToCart(o,t);showToast("\u0422\u043E\u0432\u0430\u0440 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","success"),window.applyCartState?window.applyCartState(e):T()}}catch(e){showToast(e.message||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error")}}async function T(){window.refreshCartState&&await window.refreshCartState()}async function P(){try{let o=await api.getCategories();N(o.slice(0,4))}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0439:",o)}}function N(o){let t=document.querySelector(".categories .category-grid");!t||o.length===0||(t.innerHTML=o.map(e=>`
        <a href="category.html?id=${e.id}" class="category-card">
            <div class="category-img" style="background-image: url('${window.resolveAssetUrl?window.resolveAssetUrl(e.imagePath||"../images/placeholder.jpg"):e.imagePath||"../images/placeholder.jpg"}')"></div>
            <h3>${e.name}</h3>
        </a>
    `).join(""))}async function _(){try{let o=await api.getRecentReviews(20);j(o),D()}catch(o){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043E\u0442\u0437\u044B\u0432\u043E\u0432:",o)}}function O(o){let t=(o||"").trim();if(!t)return"\u041A";let e=t.split(/\s+/).filter(Boolean);return e.length>=2?`${e[0][0]}${e[1][0]}`.toUpperCase():t.slice(0,2).toUpperCase()}function j(o){let t=document.querySelector(".testimonials .testimonial-slider");if(t){if(!Array.isArray(o)||o.length===0){t.innerHTML='<p class="loading">\u041F\u043E\u043A\u0430 \u043D\u0435\u0442 \u043E\u0442\u0437\u044B\u0432\u043E\u0432</p>';return}t.innerHTML=o.map((e,n)=>`
        <div class="testimonial-slide ${n===0?"active":""}">
            <div class="testimonial-content">
                <div class="rating">
                    ${'<i class="fas fa-star"></i>'.repeat(e.rating||5)}
                    ${'<i class="far fa-star"></i>'.repeat(Math.max(0,5-(e.rating||5)))}
                </div>
                <p class="testimonial-text">"${e.text||"\u0411\u0435\u0437 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u044F"}"</p>
                <div class="client-info">
                    <div class="client-photo">${O(e.authorName||"\u041A\u043B\u0438\u0435\u043D\u0442")}</div>
                    <div class="client-details">
                        <h4>${e.authorName||"\u041A\u043B\u0438\u0435\u043D\u0442"}</h4>
                        <p>${e.product?.name||"\u0417\u0430\u043A\u0430\u0437"}</p>
                    </div>
                </div>
            </div>
        </div>
    `).join("")}}function D(){let o=document.querySelectorAll(".testimonial-slide");if(o.length<=1)return;y&&clearInterval(y);let t=0;y=setInterval(()=>{o[t].classList.remove("active"),t=(t+1)%o.length,o[t].classList.add("active")},6e3)}document.addEventListener("DOMContentLoaded",()=>{A(),P(),_(),T(),document.querySelectorAll('a[href^="#"]').forEach(o=>{o.addEventListener("click",function(t){t.preventDefault();let e=this.getAttribute("href");if(e==="#")return;let n=document.querySelector(e);n&&n.scrollIntoView({behavior:"smooth"})})})});})();
