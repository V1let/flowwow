(()=>{function E(t){if(!t||typeof t!="string")return t;let e=t.trim();if(!e||/^(https?:)?\/\//i.test(e)||/^data:/i.test(e)||/^blob:/i.test(e))return e;let s="http://localhost:8080";return e.startsWith("/api/")?`${s}${e}`:e.startsWith("api/")?`${s}/${e}`:e}window.resolveAssetUrl=E;window.toastConfig={default:{maxMessageLength:160,showDelayMs:50,durationMs:2800,removeDelayMs:2800},admin:{maxMessageLength:160,showDelayMs:50,durationMs:2800,removeDelayMs:2800,top:"16px",right:"16px",maxWidth:"320px",padding:"10px 14px",borderRadius:"8px",fontSize:"14px",lineHeight:"1.35"}};function L(t){let e=t?window.toastConfig.admin:window.toastConfig.default,s=window.toastOverrides&&typeof window.toastOverrides=="object"?window.toastOverrides:{};return{...e,...s}}var m="3";window.showToast=function(e,s="success"){let o=window.location.pathname.includes("/other/admin"),n=L(o),i=String(e??"").replace(/\s+/g," ").trim().slice(0,n.maxMessageLength),r=document.createElement("div");r.className=`toast-notification ${s}`,r.textContent=i||"\u0413\u043E\u0442\u043E\u0432\u043E",o&&(r.classList.add("fw-admin-toast"),r.style.position="fixed",r.style.top=n.top,r.style.right=n.right,r.style.bottom="auto",r.style.left="auto",r.style.zIndex="10000",r.style.display="inline-block",r.style.height="auto",r.style.minHeight="0",r.style.maxHeight="none",r.style.maxWidth=n.maxWidth,r.style.width="auto",r.style.padding=n.padding,r.style.borderRadius=n.borderRadius,r.style.boxSizing="border-box",r.style.boxShadow="0 6px 18px rgba(0, 0, 0, 0.2)",r.style.color="#fff",r.style.fontWeight="500",r.style.fontSize=n.fontSize,r.style.lineHeight=n.lineHeight,r.style.whiteSpace="normal",r.style.overflowWrap="anywhere",r.style.wordBreak="break-word",r.style.opacity="0",r.style.transform="translateX(120%)",r.style.transition="opacity 0.25s ease, transform 0.25s ease"),document.body.appendChild(r),setTimeout(()=>{o?(r.style.opacity="1",r.style.transform="translateX(0)"):r.classList.add("show")},n.showDelayMs),setTimeout(()=>{o?(r.style.opacity="0",r.style.transform="translateX(120%)"):r.classList.remove("show"),setTimeout(()=>r.remove(),n.removeDelayMs)},n.durationMs)};document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add("content-loaded");let t=document.getElementById("header-placeholder"),e=document.getElementById("footer-placeholder"),s=window.location.pathname.includes("/other/"),o="../",n=`fw_header_${m}`,i=`fw_footer_${m}`,r=sessionStorage.getItem(n),a=sessionStorage.getItem(i);r&&a&&(t.innerHTML=r,e.innerHTML=a),Promise.all([r?Promise.resolve(r):fetch(`${o}includes/header.html?v=${m}`).then(d=>d.text()),a?Promise.resolve(a):fetch(`${o}includes/footer.html?v=${m}`).then(d=>d.text())]).then(([d,c])=>{r||sessionStorage.setItem(n,d),a||sessionStorage.setItem(i,c),t.innerHTML=d,e.innerHTML=c;let h=document.getElementById("copyright-year");h&&(h.textContent=String(new Date().getFullYear())),C(),window.refreshCartState&&window.refreshCartState();let w=document.getElementById("hamburger"),y=document.getElementById("mobile-menu");w&&y&&w.addEventListener("click",()=>{y.classList.toggle("active")});let g=document.querySelector(".scroll-top");g&&(window.addEventListener("scroll",()=>{g.classList.toggle("visible",window.scrollY>400)}),g.addEventListener("click",()=>window.scrollTo({top:0,behavior:"smooth"})));let f=document.getElementById("auth-btn"),l=document.getElementById("user-sidebar"),p=document.getElementById("close-user-sidebar"),S=document.getElementById("user-logout");f&&l&&f.addEventListener("click",()=>{localStorage.getItem("isLoggedIn")==="true"?l.classList.add("active"):window.location.href="../other/login.html"}),p&&l&&p.addEventListener("click",()=>{l.classList.remove("active")}),S&&S.addEventListener("click",I=>{I.preventDefault(),confirm("\u0412\u044B\u0439\u0442\u0438 \u0438\u0437 \u0430\u043A\u043A\u0430\u0443\u043D\u0442\u0430?")&&(localStorage.removeItem("isLoggedIn"),localStorage.removeItem("jwtToken"),localStorage.removeItem("userName"),localStorage.removeItem("userRole"),window.location.href="../pages/index.html")})}).catch(d=>console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 header/footer:",d))});document.addEventListener("click",async t=>{let e=t.target.closest(".add-to-cart");if(!e)return;let s=e.dataset.id;!s||!window.toggleCartItem||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),await window.toggleCartItem(s,1))},!0);function C(){let t=localStorage.getItem("isLoggedIn")==="true",e=localStorage.getItem("userName")||"\u0413\u043E\u0441\u0442\u044C",s=localStorage.getItem("userRole")||"USER",o=document.getElementById("auth-text"),n=document.getElementById("user-display-name"),i=document.getElementById("user-avatar");o&&(o.textContent=t?e:"\u0412\u043E\u0439\u0442\u0438"),n&&(n.textContent=e);let r=document.getElementById("admin-panel-menu-item"),a=document.getElementById("desktop-admin-link"),d=document.getElementById("mobile-admin-menu-item"),c=t&&s==="ADMIN";r&&(r.style.display=c?"":"none"),a&&(a.style.display=c?"":"none"),d&&(d.style.display=c?"":"none"),i&&(s==="ADMIN"?i.src="https://randomuser.me/api/portraits/men/1.jpg":i.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(e)}&background=e83e8c&color=fff`)}function u(t,e){if(!t)return;let s=t.dataset.originalText||t.textContent.trim()||"\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443";t.dataset.originalText||(t.dataset.originalText=s),e?(t.textContent="\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0435",t.classList.add("in-cart")):(t.textContent=t.dataset.originalText||"\u0412 \u043A\u043E\u0440\u0437\u0438\u043D\u0443",t.classList.remove("in-cart"))}function v(t,e){if(!t)return;let s=String(t);document.querySelectorAll(`.add-to-cart[data-id="${s}"]`).forEach(n=>{u(n,e)});let o=document.getElementById("add-to-cart-btn");o&&String(o.dataset.id)===s&&u(o,e)}function T(t){let e=document.getElementById("cart-count-sidebar");e&&(e.textContent=String(t??0))}window.applyCartState=function(e){if(!e){T(0),document.querySelectorAll(".add-to-cart").forEach(a=>u(a,!1));let r=document.getElementById("add-to-cart-btn");r&&u(r,!1);return}if(typeof e!="object"||(window.__lastCartState=e,e.totalItems!==void 0&&T(e.totalItems||0),!Array.isArray(e.items)))return;let s=e.items,o=new Set(s.map(r=>String(r.productId??""))),n=new Map(s.map(r=>[String(r.productId??""),String(r.id??"")]));window.__cartItemByProductId=n,document.querySelectorAll(".add-to-cart").forEach(r=>{let a=r.dataset.id;a&&u(r,o.has(String(a)))});let i=document.getElementById("add-to-cart-btn");i&&i.dataset.id&&u(i,o.has(String(i.dataset.id)))};window.toggleCartItem=async function(e,s=1){if(!e)return;if(!(typeof window.isLoggedIn=="function"?window.isLoggedIn():localStorage.getItem("isLoggedIn")==="true")){showToast("\u0412\u043E\u0439\u0434\u0438\u0442\u0435, \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error"),window.location.href="../other/login.html";return}let i=(window.__cartItemByProductId||new Map).get(String(e));try{let r=null;i?(r=await window.api.removeFromCart(i),showToast("\u0422\u043E\u0432\u0430\u0440 \u0443\u0434\u0430\u043B\u0451\u043D \u0438\u0437 \u043A\u043E\u0440\u0437\u0438\u043D\u044B","info"),v(e,!1)):(r=await window.api.addToCart(e,s),showToast("\u0422\u043E\u0432\u0430\u0440 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u043A\u043E\u0440\u0437\u0438\u043D\u0443","success"),v(e,!0)),r&&window.applyCartState&&window.applyCartState(r),window.refreshCartState&&window.refreshCartState()}catch(r){showToast(r.message||"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u043E\u0440\u0437\u0438\u043D\u0443","error")}};window.refreshCartState=async function(){if(!(typeof window.isLoggedIn=="function"?window.isLoggedIn():localStorage.getItem("isLoggedIn")==="true")){window.applyCartState(null);return}try{if(window.api&&typeof window.api.getCart=="function"){let o=await window.api.getCart();o&&typeof o=="object"&&window.applyCartState(o);return}let s=await fetch("http://localhost:8080/api/cart",{headers:{Authorization:`Bearer ${localStorage.getItem("jwtToken")}`}});if(s.ok){let o=await s.json();o&&typeof o=="object"&&window.applyCartState(o)}else window.applyCartState(null)}catch(s){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u044F \u043A\u043E\u0440\u0437\u0438\u043D\u044B:",s),window.applyCartState(null)}};(function(){let e=window.location.hostname;if(!(e==="localhost"||e==="127.0.0.1")||document.querySelector("script[data-livereload]"))return;let o=document.createElement("script");o.src=`http://${e}:35729/livereload.js?snipver=1`,o.async=!0,o.setAttribute("data-livereload","true"),document.body.appendChild(o)})();var $="http://localhost:8080/api",q={get token(){return localStorage.getItem("jwtToken")},set token(t){t?localStorage.setItem("jwtToken",t):localStorage.removeItem("jwtToken")},headers(){let t={"Content-Type":"application/json"};return this.token&&(t.Authorization=`Bearer ${this.token}`),t},async request(t,e={}){let s=await fetch($+t,{...e,headers:{...this.headers(),...e.headers}});if(s.status===401)throw this.token=null,localStorage.removeItem("isLoggedIn"),localStorage.removeItem("userRole"),window.location.href="../other/login.html",new Error("Unauthorized");if(s.status===403)throw new Error("\u0414\u043E\u0441\u0442\u0443\u043F \u0437\u0430\u043F\u0440\u0435\u0449\u0451\u043D");if(!s.ok){let n=await s.text().catch(()=>"Unknown error");throw new Error(n||s.statusText)}if(s.status===204)return null;let o=await s.text();if(!o)return null;try{return JSON.parse(o)}catch{return o}},login(t){return this.request("/auth/login",{method:"POST",body:JSON.stringify(t)})},register(t){return this.request("/auth/register",{method:"POST",body:JSON.stringify(t)})},forgotPassword(t){return this.request("/auth/forgot-password",{method:"POST",body:JSON.stringify({email:t})})},resetPassword(t,e){return this.request("/auth/reset-password",{method:"POST",body:JSON.stringify({token:t,newPassword:e})})},getProducts(t={}){let e=new URLSearchParams(t).toString();return this.request(`/products?${e}`)},getProductBySlug(t){return this.request(`/products/${t}`)},getProductById(t){return this.request(`/products/id/${t}`)},getHits(){return this.request("/products/hits")},getNew(){return this.request("/products/new")},getCategories(){return this.request("/categories")},getCategoryBySlug(t){return this.request(`/categories/${t}`)},getCategoryById(t){return this.request(`/categories/id/${t}`)},getCart(){return this.request("/cart")},addToCart(t,e=1){return this.request("/cart/items",{method:"POST",body:JSON.stringify({productId:t,quantity:e})})},updateCartItem(t,e){return this.request(`/cart/items/${t}?quantity=${e}`,{method:"PUT"})},removeFromCart(t){return this.request(`/cart/items/${t}`,{method:"DELETE"})},clearCart(){return this.request("/cart",{method:"DELETE"})},getFavorites(){return this.request("/favorites")},addToFavorite(t){return this.request(`/favorites/${t}`,{method:"POST"})},removeFromFavorite(t){return this.request(`/favorites/${t}`,{method:"DELETE"})},isFavorite(t){return this.request(`/favorites/check/${t}`)},getMyOrders(){return this.request("/orders/my")},getOrderById(t){return this.request(`/orders/${t}`)},createOrder(t){return this.request("/orders",{method:"POST",body:JSON.stringify(t)})},getProductReviews(t){return this.request(`/reviews/product/${t}`)},getRecentReviews(t=3){return this.request(`/reviews/recent?limit=${t}`)},createReview(t,e,s){let o=localStorage.getItem("userName")||"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C";return this.request("/reviews",{method:"POST",body:JSON.stringify({productId:t,authorName:o,rating:e,text:s})})},getTestimonials(){return this.request("/content/testimonials")},getTeamMembers(){return this.request("/content/team")},getBlogPosts(t=0,e=10){return this.request(`/content/blog?page=${t}&size=${e}`)},getBlogPostBySlug(t){return this.request(`/content/blog/${t}`)},getDashboard(){return this.request("/admin/dashboard")},getAdminProducts(){return this.request("/admin/products")},getArchivedAdminProducts(){return this.request("/admin/products/archive")},createProduct(t){return this.request("/admin/products",{method:"POST",body:JSON.stringify(t)})},updateProduct(t,e){return this.request(`/admin/products/${t}`,{method:"PUT",body:JSON.stringify(e)})},updateProductPartial(t,e){return this.request(`/admin/products/${t}`,{method:"PATCH",body:JSON.stringify(e)})},uploadProductImage(t,e,s=!1){let o=new FormData;return o.append("file",e),o.append("isMain",s?"true":"false"),fetch(`${$}/products/${t}/images/upload`,{method:"POST",headers:this.token?{Authorization:`Bearer ${this.token}`}:{},body:o}).then(async n=>{if(!n.ok){let i=await n.text().catch(()=>"Upload error");throw new Error(i||n.statusText)}return n.json()})},deleteProduct(t){return this.request(`/admin/products/${t}`,{method:"DELETE"})},restoreProduct(t){return this.request(`/admin/products/${t}/restore`,{method:"POST"})},getAdminOrders(t=0,e=10){return this.request(`/admin/orders?page=${t}&size=${e}`)},getAdminOrderById(t){return this.request(`/admin/orders/${t}`)},updateOrderStatus(t,e){return this.request(`/admin/orders/${t}/status?status=${e}`,{method:"PUT"})},getAdminCategories(){return this.request("/admin/categories")},createCategory(t){return this.request("/admin/categories",{method:"POST",body:JSON.stringify(t)})},updateCategory(t,e){return this.request(`/admin/categories/${t}`,{method:"PUT",body:JSON.stringify(e)})},deleteCategory(t){return this.request(`/admin/categories/${t}`,{method:"DELETE"})},getAdminUsers(t=0,e=10){return this.request(`/admin/users?page=${t}&size=${e}`)},updateUserStatus(t,e){return this.request(`/admin/users/${t}/status?isActive=${e}`,{method:"PUT"})},deleteUser(t){return this.request(`/admin/users/${t}`,{method:"DELETE"})},getPendingReviews(t=0,e=10){return this.request(`/reviews/pending?page=${t}&size=${e}`)},approveReview(t){return this.request(`/reviews/${t}/approve`,{method:"POST"})},rejectReview(t){return this.request(`/reviews/${t}/reject`,{method:"POST"})}};window.api=q;window.isLoggedIn=function(){return localStorage.getItem("isLoggedIn")==="true"};window.isAdmin=function(){return localStorage.getItem("userRole")==="ADMIN"&&window.isLoggedIn()};window.getJwtToken=function(){return localStorage.getItem("jwtToken")};document.addEventListener("DOMContentLoaded",async()=>{if(!isLoggedIn()){window.location.href="../other/login.html";return}let t=document.getElementById("orders-list"),e=document.getElementById("orders-empty");try{let s=await api.getMyOrders();if(!s||s.length===0){e.style.display="block",t.innerHTML="";return}t.innerHTML=s.map(o=>{let n=o.orderNumber||`#${o.id}`,i=o.totalAmount?Number(o.totalAmount).toLocaleString():"0",r=o.createdAt?new Date(o.createdAt).toLocaleDateString("ru-RU"):"",a=o.deliveryDate?new Date(o.deliveryDate).toLocaleDateString("ru-RU"):"",d=Array.isArray(o.items)?o.items.length:0;return`
                <div class="order-summary" style="margin: 16px 0;">
                    <div style="display: flex; justify-content: space-between; gap: 16px; flex-wrap: wrap;">
                        <div>
                            <h3 style="margin: 0 0 6px;">\u0417\u0430\u043A\u0430\u0437 ${n}</h3>
                            <div style="color: #666; font-size: 0.95rem;">
                                ${r?`\u0414\u0430\u0442\u0430: ${r}`:""}${a?` \xB7 \u0414\u043E\u0441\u0442\u0430\u0432\u043A\u0430: ${a}`:""}
                            </div>
                            <div style="color: #666; font-size: 0.95rem;">
                                \u0421\u0442\u0430\u0442\u0443\u0441: ${o.status||"NEW"} \xB7 \u041F\u043E\u0437\u0438\u0446\u0438\u0439: ${d}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.2rem; font-weight: 700;">${i} \u20BD</div>
                        </div>
                    </div>
                </div>
            `}).join("")}catch(s){t.innerHTML=`<p class="error">\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0437\u0430\u043A\u0430\u0437\u043E\u0432: ${s.message}</p>`}});})();
